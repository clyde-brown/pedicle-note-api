# 페디클 UI/UX 페이지 정의서 (토스 스타일)

> **기반 문서**: `docs/10-product/11-problem-define/problem-definition-v2.md`, `docs/40-planning/41-prd/prd-mvp-v1.md`  
> **목적**: AI·개발자가 화면 단위로 구현할 수 있도록, 토스 디자인 특성을 반영한 페이지별 UI/UX 상세 명세.  
> **원칙**: 진료 흐름을 방해하지 않음(최소 입력·한 화면 한 목적)·환자와 함께 볼 수 있는 간결함·의사-환자 아이컨택 우선.

---

## 목차 (사이드 네비게이션)

- [1. 디자인 원칙 및 토스 정렬](#1-디자인-원칙-및-토스-정렬)
  - [1.1 토스 스타일 핵심 특성 → 페디클 매핑](#11-토스-스타일-핵심-특성--페디클-매핑)
  - [1.2 페디클 전용 제약 (문제정의서·PRD 반영)](#12-페디클-전용-제약-문제정의서prd-반영)
- [2. 글로벌 컴포넌트](#2-글로벌-컴포넌트)
  - [2.1 공통 컴포넌트 스펙](#21-공통-컴포넌트-스펙)
  - [2.2 색상·타이포](#22-색상타이포)
  - [2.3 환자 대면 모드 전용](#23-환자-대면-모드-전용)
  - [2.4 인터랙션·접근성 규칙](#24-인터랙션접근성-규칙)
  - [2.5 컴포넌트 결정 로그 (AI 참고)](#25-컴포넌트-결정-로그-ai-참고)
- [3. 페이지별 UI/UX 상세 정의](#3-페이지별-uiux-상세-정의)
  - [3.1 로그인 페이지](#31-로그인-페이지)
  - [3.2 대시보드](#32-대시보드)
  - [3.3 환자 목록 / 검색](#33-환자-목록--검색)
  - [3.4 환자 등록](#34-환자-등록)
  - [3.5 진료 차팅 (Encounter) – 개요 및 서브 플로우](#35-진료-차팅-encounter--개요-및-서브-플로우)
    - [3.5.1 서브 플로우: 차팅 (S-T-D 입력)](#351-서브-플로우-차팅-s-t-d-입력)
    - [3.5.2 서브 플로우: 환자 설명](#352-서브-플로우-환자-설명)
    - [3.5.3 서브 플로우: ICD 선택](#353-서브-플로우-icd-선택)
    - [3.5.4 서브 플로우: 요약 발송](#354-서브-플로우-요약-발송)
  - [3.6 Problem Unit 관리](#36-problem-unit-관리)
  - [3.7 재진 변화 비교](#37-재진-변화-비교)
  - [3.8 신체검사](#38-신체검사)
  - [3.9 환자 설명 모드](#39-환자-설명-모드)
  - [3.10 진료 요약 생성·발송](#310-진료-요약-생성발송)
  - [3.11 유사 사례 조회](#311-유사-사례-조회)
  - [3.12 Admin – 병원 관리](#312-admin--병원-관리)
  - [3.13 Admin – 사용자 관리](#313-admin--사용자-관리)
  - [3.14 Admin – 템플릿 관리](#314-admin--템플릿-관리)
  - [3.15 Admin – 진료 통계](#315-admin--진료-통계)
  - [3.16 Admin – 데이터 품질](#316-admin--데이터-품질)
  - [3.17 Admin – 요금제](#317-admin--요금제)
- [4. 공통 엣지 케이스·에러 정책](#4-공통-엣지-케이스에러-정책)
- [5. AI·개발자용 체크리스트 (페이지 구현 시)](#5-aideveloper용-체크리스트-페이지-구현-시)
- [6. 페이지–라우트·기능 ID 매핑 (Quick Reference)](#6-페이지라우트기능-id-매핑-quick-reference)

---

## 1. 디자인 원칙 및 토스 정렬

### 1.1 토스 스타일 핵심 특성 → 페디클 매핑

| 토스 특성 | 페디클 적용 | 구현 가이드 |
|-----------|-------------|-------------|
| **한 화면 한 질문/한 목적** | 진료 중 한 번에 하나의 결정만 유도 (부위 선택 → 통증도 → 치료 한 가지씩) | 섹션당 Primary CTA 1개, 나머지는 보조 버튼 또는 링크 |
| **카드 기반 정보 그룹핑** | Problem 카드, Encounter 카드, 검사 결과 카드로 시각적 구분 | 카드: `border-radius: 12px`, `padding: 16px`, `box-shadow: 0 2px 8px rgba(0,0,0,0.06)` |
| **프로그레시브 디스클로저** | 필수: 부위·좌우·통증도만 먼저 → "더 입력하기" 시 통증 유형·악화/완화 요인·발생 시점·유발 동작 확장 | 기본 상태는 S-1(부위) + S-3(통증 강도)만 노출, "더 입력하기" 터치 시 S-2(통증 유형), S-4(악화 요인), S-5(완화 요인), S-6(발생 시점), S-7(유발 동작) 확장, "간단히 입력"으로 다시 접힘 |
| **짧고 친근한 문장** | "어디가 불편하세요?" "오늘은 어때요?" "이전보다 나아졌나요?" | 문장 길이 15자 이내 권장, 의학 용어 대신 일상어 |
| **숫자·칩으로 빠른 선택** | 통증도 1–5 칩, 부위 칩, 좌/우 토글 | 칩: `padding 8px 14px`, 선택 시 primary 배경, 미선택 시 회색 배경 |
| **바텀시트로 분기** | ICD 선택, 검사 항목 선택, 템플릿 선택, 해부학 부위 선택, 통증/악화 요인 선택은 바텀시트로 메인 흐름 유지 | 바텀시트 높이: 50% / 70% / 90% (내용량에 따라), 드래그 핸들 필수, 백드롭 터치 시 닫힘, "확인" 버튼으로 선택 확정 |
| **스켈레톤 로딩** | 목록·카드 로딩 시 회색 블록 애니메이션 | 카드 수만큼 스켈레톤 표시, 텍스트 라인 2~3줄 |
| **에러 시 재시도·대안 제시** | "저장에 실패했어요. 다시 시도할까요?" + 오프라인 시 "나중에 동기화" | 에러 카드 내 [다시 시도] 버튼, 오프라인 배너 + 로컬 저장 안내 |
| **빈 상태(Empty) 안내** | "아직 오늘 진료가 없어요" → "환자 선택해서 진료 시작" | 일러스트 또는 아이콘 + 한 줄 설명 + 1개 CTA |
| **고정 하단 CTA** | "진료 저장", "다음 환자", "설명 보기" | `position: sticky; bottom: 0`, safe area padding, 버튼 높이 56px |

### 1.2 페디클 전용 제약 (문제정의서·PRD 반영)

- **진료 중 화면 주시 최소화**: 한 블록당 입력 포인트 1~3개, 기본값·템플릿으로 대부분 1탭으로 완료.
- **환자 대면 모드**: 폰트 18px 이상, 대비 높은 색상, "환자에게 보여주기" 전용 뷰(의학용어 → 일상어 자동 변환).
- **재진 30초 준비**: 대시보드에서 재진 환자 카드 터치 시 이전 요약·변화 하이라이트가 첫 화면에 표시.
- **가설 허용**: "아직 확정 아님" 토글/뱃지로 표시, 확정 시에만 체크 아이콘.

---

## 2. 글로벌 컴포넌트

### 2.1 공통 컴포넌트 스펙

| 컴포넌트 ID | 용도 | 스펙 | 상태 |
|-------------|------|------|------|
| **G-BTN-PRIMARY** | 주 행동 1개 (저장, 진료 시작, 다음) | 배경 `#3182F6`, 높이 56px, border-radius 12px, 흰색 글자 17px bold | default / loading(스피너) / disabled |
| **G-BTN-SECONDARY** | 보조 행동 (취소, 더보기) | 배경 투명, 테두리 1px #E5E8EB, 글자 #4E5968 | default / disabled |
| **G-BTN-GHOST** | 약한 보조 (뒤로, 링크형) | 배경 없음, 글자 #3182F6 또는 #4E5968 | default |
| **G-CARD** | 정보 묶음 (Problem, Encounter, 검사) | padding 16px, radius 12px, shadow 0 2px 8px rgba(0,0,0,0.06) | default / selected(border 2px #3182F6) / disabled |
| **G-CHIP** | 단일 선택 (부위, 통증도, 옵션) | padding 8px 14px, radius 20px, 14px medium | unselected(#F2F4F6) / selected(#3182F6 배경, 흰색) |
| **G-TOGGLE** | 좌/우, 예/아니오, 가설/확정 | 트랙 44x24, thumb 20x20, on 시 #3182F6 | on / off |
| **G-INPUT** | 한 줄 입력 (이름, 차트번호) | 높이 48px, radius 8px, border 1px #E5E8EB, placeholder #ADB5BD | default / focus / error / disabled |
| **G-BOTTOM-SHEET** | 선택/필터 (ICD, 템플릿, 검사 항목, 해부학 부위, 통증/악화 요인) | 백드롭 dim, 패널 radius 16px 16px 0 0, 드래그 핸들 4px 높이 34px 너비 | 50% / 70% / 90% height |
| **G-ANATOMY-PICKER** | 해부학적 부위 선택 (C1-C7, T1-T12, L1-L5, S1-S5 등) | G-BOTTOM-SHEET (90% 높이) 내부: 탭(경추/흉추/요추/천골·미골/사지·관절/기타) + 해부학 도식(터치 선택) + 검색 G-INPUT + 자주 쓰는 부위 상단 고정 + 리스트(G-CHIP 그리드), 다중 선택·좌/우/양측 선택 | - |
| **G-CHIP-GRID** | 다중 선택 칩 그리드 (통증 유형, 악화/완화 요인 등) | **기본값 세트**(관리자 편집 가능, Admin 마스터) + **자주 쓰는 항목** 상단 고정. 2–3열 그리드, 스크롤·검색 필터링. 본문 고정 리스트 없음. | unselected / selected |
| **G-SEARCHABLE-LIST** | 검색 가능한 선택 리스트 (통증·악화·완화 요인 등) | 상단 검색 G-INPUT(300ms 디바운스) + 자주 쓰는 항목 고정 영역 + 기본값 세트 리스트(G-CHIP-GRID), 검색 결과 없음 시 G-EMPTY, "전체 보기" G-BTN-GHOST | - |
| **G-NAV-BAR** | 상단 타이틀 + 뒤로/메뉴 | 높이 56px, 타이틀 18px bold, 좌측 뒤로 아이콘 24px | default / transparent(대면 모드) |
| **G-FLOATING-CTA** | 하단 고정 버튼 | sticky bottom, safe-area 하단 24px, 좌우 20px | 1개만 노출 권장 |
| **G-BADGE** | 상태 표시 (재진, 미완성, 가설) | 작은 pill, 12px, padding 4px 8px | info(파랑) / warning(노랑) / success(초록) / neutral(회색) |
| **G-EMPTY** | 결과 없음 | 아이콘 64px + 제목 18px bold + 설명 14px #6B7684 + CTA 1개 | - |
| **G-ERROR-BLOCK** | 오류 메시지 + 재시도 | 카드 형태, 아이콘 + 메시지 + [다시 시도] 버튼 | - |
| **G-SKELETON-CARD** | 로딩 중 카드 | 회색 직사각형 2~3개, shimmer 애니메이션 | - |

### 2.2 색상·타이포

- **Primary**: `#3182F6` (토스 블루)
- **Success**: `#00C48C` (완료, 개선)
- **Warning**: `#FFB340` (미완성, 주의)
- **Error**: `#F04452` (실패, 위험)
- **Text Primary**: `#191F28`, **Secondary**: `#4E5968`, **Tertiary**: `#6B7684`, **Placeholder**: `#ADB5BD`
- **Background**: `#F9FAFB`, **Card**: `#FFFFFF`
- **폰트**: 제목 18~20px bold, 본문 15~16px regular, 캡션 13px, 숫자/강조 17px medium

### 2.3 환자 대면 모드 전용

- **폰트 크기**: 본문 최소 18px, 제목 22px.
- **대비**: 배경 흰색, 글자 #191F28, 의학 용어는 자동 치환된 "환자용 문구"만 표시.
- **CTA**: "다음", "이해했어요" 등 한 단어 위주.

#### 환자 대면 모드 최소 정책 (변환·수정·금지 표현)

> 상세 정책은 PRD **P-REQ-005**(의학 용어 변환 수준) 확정 후 반영. 아래는 UI 명세용 최소 가이드.

| 구분 | 최소 정책 | 비고 |
|------|-----------|------|
| **변환 규칙** | 의학 용어 → 일상어 자동 치환. 해부학 코드(예: C5, L4) → 부위 설명문(예: "목뼈 5번째", "허리 4번째"). 진단명·처방명은 규칙 테이블 또는 관리자 설정(마스터) 기반. | 변환 규칙 세트는 Admin·마스터 데이터에서 편집 가능 여부는 P-REQ로 결정. |
| **수정 가능 여부** | 환자 대면 화면에서 의사가 **변환 결과를 수정할 수 있음**(문구만 수정, 원본 S-T-D 데이터는 변경 없음). 수정 시 "환자용 문구 오버라이드"로 저장. | 수정 불가로 할지 여부는 P-REQ-005. |
| **금지 표현** | 환자 대면 뷰에는 **금지 표현 목록**에 있는 문구 노출 금지(예: "악성", "전이" 등 직접 노출 대신 "추가 검사가 필요해요" 등으로 대체). 금지 목록은 관리자 설정 또는 시스템 기본값. | 금지 표현 목록·대체 문구는 P-REQ 또는 clinical-policy 확정. |

### 2.4 인터랙션·접근성 규칙

- **터치 타겟**: 버튼·칩·리스트 행 최소 44px 높이 (토스 가이드).
- **애니메이션**: 페이지 전환 200–300ms ease-out; 바텀시트 등장 250ms; 스켈레톤 shimmer 1.5s 무한.
- **포커스**: 키보드 네비게이션 시 focus ring 2px #3182F6.
- **스크린리더**: 카드·버튼에 aria-label, "환자 설명 모드" 전환 시 live region으로 "환자용 설명 화면입니다" 안내.

### 2.5 컴포넌트 결정 로그 (AI 참고)

| 결정 | 선택 | 이유 (토스·문제정의 반영) |
|------|------|---------------------------|
| 다중 선택 UI | G-CHIP 그룹 | 빠른 선택, 진료 중 입력 수 최소화(한 번에 여러 부위/통증도 가능) |
| ICD 선택 | G-BOTTOM-SHEET | 메인 흐름(차팅) 유지, 검색·리스트는 보조 화면으로 분리 |
| 해부학 부위 선택 | G-ANATOMY-PICKER (바텀시트 내) | 30개+ 부위를 탭·도식·검색으로 빠르게 선택, 진료 중 입력 최소화 |
| 통증/악화 요인 선택 | G-SEARCHABLE-LIST + G-CHIP-GRID | **기본값 세트**(관리자 편집) + **자주 쓰는 항목** 상단 고정으로 빠른 접근, 본문 고정 리스트 없음 |
| 진료 저장 | G-FLOATING-CTA | 항상 노출, 스크롤 위치와 무관하게 저장 가능 |
| 재진 비교 | 상단 블록 자동 노출 | "30초 내 준비" 목표, 별도 탭 이동 없이 맥락 제공 |
| Situation 입력 | 프로그레시브 디스클로저 | 기본은 부위+통증도만, "더 입력" 시 통증 유형·악화 요인 등 확장, 진료 흐름 방해 최소화 |
| 빈 목록 | G-EMPTY + 단일 CTA | 토스 패턴: 설명 한 줄 + 다음 행동 하나만 제시 |
| 에러 | G-ERROR-BLOCK + 재시도 | 사용자가 할 수 있는 다음 행동 명시, 공황 유발 문구 지양 |

---

## 3. 페이지별 UI/UX 상세 정의

---

### 3.1 [로그인 페이지]

**페이지 ID**: `P-LOGIN`  
**역할**: 테넌트(병원) 식별 + 사용자 인증, JWT 발급 후 Physician/Admin 콘솔 분기.  
**기능 ID**: F001

#### 3.1.1 진입 경로

- 최초 접속 URL, 세션 만료 시 리다이렉트.

#### 3.1.2 레이아웃

- **상단**: 로고 + "페디클" 텍스트 (중앙 정렬).
- **중앙**: 단일 컬럼 폼.
  - **블록 1 – 병원 코드**: G-INPUT 1개, placeholder "병원 코드 입력", type text, max 10자.
  - **블록 2 – 아이디**: G-INPUT, placeholder "아이디".
  - **블록 3 – 비밀번호**: G-INPUT, type password, placeholder "비밀번호".
  - **블록 4**: "자동 로그인" G-TOGGLE (선택).
  - **블록 5**: G-BTN-PRIMARY "로그인" (전체 너비).
  - **블록 6**: G-BTN-GHOST "비밀번호 찾기" (중앙).

#### 3.1.3 상태

| 상태 | 트리거 | UI |
|------|--------|-----|
| default | 초기 | 위 레이아웃 그대로 |
| loading | 로그인 요청 중 | 로그인 버튼 → G-BTN-PRIMARY loading (스피너), 입력 비활성화 |
| error – 잘못된 코드/비번 | 401 등 | 병원 코드 또는 비밀번호 아래 빨간 문구 13px "병원 코드를 확인해주세요" / "아이디 또는 비밀번호를 확인해주세요", 해당 G-INPUT error 상태 |
| error – 네트워크 | 5xx/타임아웃 | 상단 G-ERROR-BLOCK "잠시 문제가 생겼어요. 다시 시도해주세요." + [다시 시도] |

#### 3.1.4 복사(문구)

- 로그인 버튼: "로그인"
- 비밀번호 찾기: "비밀번호 찾기"
- 에러: "병원 코드를 확인해주세요" / "아이디 또는 비밀번호를 확인해주세요" / "잠시 문제가 생겼어요. 다시 시도해주세요."

#### 3.1.5 인터랙션·규칙

- 병원 코드 미입력 시 로그인 버튼 disabled.
- 아이디·비밀번호 둘 다 입력 시에만 로그인 버튼 enabled.
- 엔터 키 → 로그인 submit.
- 성공 시 role에 따라 `/dashboard`(의사) 또는 `/admin`(관리자)로 이동.

#### 3.1.6 엣지 케이스

- **잘못된 병원 코드**: 블록 1 아래 에러 메시지, 포커스 병원 코드 입력.
- **계정 잠금/비활성**: 403 시 "이 계정은 사용할 수 없어요. 관리자에게 문의해주세요." + G-ERROR-BLOCK.
- **첫 로그인/비밀번호 변경 필요**: 200 + `requirePasswordChange` 시 비밀번호 변경 페이지로 리다이렉트 (별도 페이지 스펙).

---

### 3.2 [대시보드]

**페이지 ID**: `P-DASHBOARD`  
**역할**: 오늘 진료 현황 파악, 대기 환자 선택, 재진 예정·미완성 차트 알림. 30초 내 다음 진료 준비.  
**기능 ID**: F002, F016, F018

#### 3.2.1 진입 경로

- 로그인 직후 기본 화면, G-NAV-BAR "대시보드".

#### 3.2.2 레이아웃

- **상단**: G-NAV-BAR "대시보드", 우측 아이콘(알림 또는 설정) 선택 사항.
- **섹션 1 – 오늘의 숫자 (카드 3개 가로)**  
  - 카드 1: "오늘 진료", 숫자(큰 폰트), 전일 대비 "+n명" (초록) 또는 "-n명" (회색).  
  - 카드 2: "대기 중", 숫자.  
  - 카드 3: "미완성 차트", 숫자 (0이면 회색, 1 이상이면 G-BADGE warning).
- **섹션 2 – 대기 환자**  
  - 제목: "대기 환자" + "전체보기" G-BTN-GHOST (→ 환자 목록).  
  - 리스트: G-CARD 각 행 = [이름 | 차트번호 | "초진" 또는 "재진" G-BADGE] + 우측 chevron. 터치 → 해당 환자 진료 시작(Encounter 생성).
- **섹션 3 – 재진 예정**  
  - 제목: "재진 예정 오늘".  
  - 리스트: G-CARD [이름 | 마지막 진단명 요약 | "n일 전" ] + chevron. 터치 → 진료 시작 + 이전 요약 노출.
- **섹션 4 – 미완성 차트 알림 (조건부)**  
  - 미완성 차트 > 0일 때만: G-CARD warning 스타일 "차트 n건 미완성" + "이어서 작성" → 해당 Encounter 차팅 화면.

#### 3.2.3 상태

| 상태 | 트리거 | UI |
|------|--------|-----|
| default | 데이터 있음 | 위 4섹션 표시 |
| loading | 초기 로드 | 섹션 2·3 자리에 G-SKELETON-CARD 각 5개 |
| empty – 대기 0명 | 오늘 대기 0명 | 섹션 2에 G-EMPTY "아직 대기 중인 환자가 없어요" + "환자 검색" G-BTN-PRIMARY |
| empty – 재진 0명 | 재진 예정 0명 | 섹션 3에 G-EMPTY "오늘 재진 예정이 없어요" (CTA 없음) |
| error | API 실패 | 섹션 2 상단 G-ERROR-BLOCK + [다시 시도] |

#### 3.2.4 복사

- "오늘 진료", "대기 중", "미완성 차트", "대기 환자", "재진 예정 오늘", "전체보기", "이어서 작성", "차트 n건 미완성", "아직 대기 중인 환자가 없어요", "환자 검색".

#### 3.2.5 인터랙션

- 대기 환자 카드 터치 → F004 Encounter 생성 (또는 기존 진행 중 Encounter 있으면 해당 차팅으로).
- 재진 예정 카드 터치 → Encounter 생성 + 재진 플래그로 진료 화면에서 "이전 요약" 자동 노출.
- 새로고침: 풀 다운 또는 상단 새로고침 아이콘.

#### 3.2.6 엣지 케이스

- **동일 환자 중복 대기**: 한 환자 한 카드만, "재진" 뱃지로 구분.
- **진료 중인 Encounter 있음**: 상단 배너 "OOO 환자 진료 중" + "이어가기" → 해당 차팅으로.

---

### 3.3 [환자 목록 / 검색]

**페이지 ID**: `P-PATIENT-LIST`  
**역할**: 이름·차트번호로 환자 검색, 목록에서 선택 후 진료 시작 또는 상세.  
**기능 ID**: F002

#### 3.3.1 진입 경로

- 대시보드 "전체보기", 메뉴 "환자 관리" > "환자 검색".

#### 3.3.2 레이아웃

- **상단**: G-NAV-BAR "환자 검색" + 뒤로.
- **검색 영역**: G-INPUT (돋보기 아이콘), placeholder "이름 또는 차트번호로 검색". 입력 시 300ms 디바운스 후 검색.
- **결과 영역**:  
  - **있음**: 리스트 각 행 = G-CARD [이름 | 차트번호 | 생년월일] + chevron.  
  - **없음**: G-EMPTY "검색 결과가 없어요" + "신규 환자 등록" G-BTN-SECONDARY.  
  - **검색 전**: "이름 또는 차트번호를 입력해주세요" (회색 텍스트).

#### 3.3.3 상태

- default / loading (스켈레톤) / empty / error (G-ERROR-BLOCK + 재시도).

#### 3.3.4 인터랙션

- 행 터치 → 환자 상세(또는 바로 진료 시작 선택 가능 시) 바텀시트: "진료 시작" / "정보 보기" 두 액션.
- 무한 스크롤 또는 "더보기" (페이지네이션).

#### 3.3.5 엣지 케이스

- **2자 미만 검색**: 검색 요청 안 함, "2글자 이상 입력해주세요" 캡션.
- **동일 이름 다수**: 차트번호·생년월일로 구분 표시.

---

### 3.4 [환자 등록]

**페이지 ID**: `P-PATIENT-REGISTER`  
**역할**: 신규 환자 정보 입력, tenant_id 할당.  
**기능 ID**: F003

#### 3.4.1 레이아웃

- G-NAV-BAR "신규 환자 등록" + 뒤로.
- 단일 컬럼 폼:  
  - 차트번호 G-INPUT (필수),  
  - 이름 G-INPUT (필수),  
  - 생년월일 G-INPUT (date 또는 생년월일 전용 피커),  
  - 성별 G-CHIP "남" "여" (필수),  
  - 연락처 G-INPUT (선택).  
- 하단 G-FLOATING-CTA: G-BTN-PRIMARY "등록하기".

#### 3.4.2 상태·검증

- 필수 미입력 시 버튼 disabled.  
- 차트번호 중복 시 G-INPUT error + "이미 사용 중인 차트번호예요".
- 성공 시 토스트 "등록했어요" + 환자 상세 또는 진료 시작으로 이동(플로우 정책에 따름).

---

### 3.5 [진료 차팅 (Encounter) – 개요 및 서브 플로우]

**페이지 ID**: `P-ENCOUNTER-CHART` (허브)  
**역할**: 진료 세션(Encounter)의 진입점. 차팅·환자설명·ICD선택·요약발송 4개 **서브 플로우**로 분리하여 과밀 방지.  
**기능 ID**: F004, F031, F034, F005–F007, F008–F010, F012, F032, F033

#### 3.5.0 진입 경로·플로우 구조

- **진입**: 대시보드/환자 목록에서 환자 선택 → "진료 시작" → Encounter 생성 후 **차팅 서브 플로우**가 기본 화면.
- **네비게이션**: 상단 G-NAV-BAR 또는 탭/메뉴로 4개 서브 플로우 전환.
  - **차팅** (S-T-D 입력) → [3.5.1](#351-서브-플로우-차팅-s-t-d-입력)
  - **환자 설명** → [3.5.2](#352-서브-플로우-환자-설명) (상세 [3.9](#39-환자-설명-모드))
  - **ICD 선택** → [3.5.3](#353-서브-플로우-icd-선택)
  - **요약 발송** → [3.5.4](#354-서브-플로우-요약-발송) (상세 [3.10](#310-진료-요약-생성발송))
- **저장**: 차팅 서브 플로우에서 "진료 저장" (F012). 자동 저장 정책은 별도.

---

#### 3.5.1 서브 플로우: 차팅 (S-T-D 입력)

**서브 플로우 ID**: `P-CHART-MAIN`  
**기능 ID**: F034, F005, F006, F007, F012

- **상단**: G-NAV-BAR [환자 이름 | 차트번호] + "환자 설명" / "ICD 선택" / "요약 발송" G-BTN-GHOST 또는 탭 + 메뉴(⋯).
- **블록 A – 오늘의 문제(Problem)**  
  - "어디가 불편하세요?" 제목. 기존 Problem 카드들 (재진 시) + "새 문제 추가" G-BTN-SECONDARY.  
  - 각 카드: [부위·좌우·통증도 요약] + "변화 입력" 또는 "상세 입력".
- **블록 B – 선택한 Problem 상세 (S-T-D)**  
  - **S (Situation)**  
    - **S-1. 해부학적 부위** (필수): G-ANATOMY-PICKER, 탭(경추/흉추/요추/천골·사지·기타), 도식·검색·좌우 선택, "빠른 선택" 상단 고정.  
    - **S-2. 통증 유형** (선택): **기본값 세트**(관리자 편집 가능, Admin 템플릿/마스터) + **자주 쓰는 항목**(의사별·병원별 집계 또는 관리자 지정) 상단 고정. G-BOTTOM-SHEET 내 G-CHIP-GRID, 검색 필터. 본문에 고정 리스트 없음.  
    - **S-3. 통증 강도** (필수): 1–5 G-CHIP.  
    - **S-4. 악화 요인** (선택): **기본값 세트**(관리자 편집) + **자주 쓰는 항목** 상단 고정. G-BOTTOM-SHEET, 검색·카테고리 탭 옵션. 본문에 고정 리스트 없음.  
    - **S-5. 완화 요인** (선택): 동일 구조(기본값 세트 + 자주 쓰는 항목).  
    - **S-6. 발생 시점** (선택): "언제부터?" G-INPUT (날짜/텍스트).  
    - **S-7. 유발 동작** (선택): 한 줄 G-INPUT.  
    - **프로그레시브 디스클로저**: 기본은 S-1 + S-3만 노출, "더 입력하기"로 S-2, S-4, S-5, S-6, S-7 확장. "간단히 입력"으로 접힘.  
    - **템플릿**: "자주 쓰는 조합 저장" / "템플릿 불러오기" (Admin 템플릿 관리와 연동).  
  - **T**: 치료 칩/한 줄 + 가설 G-TOGGLE.  
  - **D**: 재진 일자, 예상 경과 칩.
- **하단**: G-FLOATING-CTA "진료 저장".

**통증 유형·악화/완화 요인 데이터 정책**  
- **기본값 세트**: 통증 유형·악화 요인·완화 요인 항목은 **마스터 데이터**(Admin > 템플릿/마스터 관리)에서 편집 가능. UI는 "기본값 세트 + 자주 쓰는 항목"만 노출.  
- **자주 쓰는 항목**: 의사별 사용 빈도 또는 관리자 지정 상위 N개를 상단 고정. 없으면 기본값 세트 중 일부를 "자주 쓰는 항목"으로 표시.  
- **본문 고정 리스트**: 사용하지 않음. 항목 구성은 관리자 설정에 따름.

**상태·복사·인터랙션·엣지 케이스**  
- 상태: loading(스켈레톤), auto-saving, save error, offline 배너.  
- 복사: "어디가 불편하세요?", "부위 추가", "통증 유형 추가", "악화 요인 추가", "완화 요인 추가", "더 입력하기", "간단히 입력", "진료 저장", "검색 결과가 없어요", "확인" 등.  
- 엣지: 부위 미선택 시 저장 비활성, 검색 결과 없음 G-EMPTY, 템플릿 덮어쓰기 확인, 긴급 진료 시 최소만 입력.

---

#### 3.5.2 서브 플로우: 환자 설명

**서브 플로우 ID**: `P-CHART-PATIENT-EXPLAIN`  
**기능 ID**: F031, F032

- 진입: 차팅 화면 상단/메뉴 "환자 설명" 터치.
- **환자 대면 모드** 전용 뷰: S-T-D·진단·치료를 **의학 용어 → 일상어 변환** (변환 규칙·수정 가능 여부·금지 표현은 [2.3 환자 대면 모드 최소 정책](#환자-대면-모드-최소-정책-변환수정금지-표현) 및 P-REQ-005 참고). 폰트 18px+, CTA "이해했어요".
- 상세 레이아웃·복사: [3.9 환자 설명 모드](#39-환자-설명-모드).

---

#### 3.5.3 서브 플로우: ICD 선택

**서브 플로우 ID**: `P-CHART-ICD`  
**기능 ID**: F008, F009, F010

- 진입: 차팅 화면 상단/메뉴 "ICD 선택" 터치.
- **진단 제안** (F008) 자동 노출, 리스트 터치로 선택/해제. "직접 검색" → G-BOTTOM-SHEET (F009). 선택 확정 시 F010.
- 별도 전용 페이지 없이 바텀시트 또는 차팅 내 블록으로 구현 가능.

---

#### 3.5.4 서브 플로우: 요약 발송

**서브 플로우 ID**: `P-CHART-SUMMARY`  
**기능 ID**: F033

- 진입: 차팅 화면 메뉴 "요약 발송" 또는 진료 종료 시 "진료 요약 보내기".
- 요약 미리보기 → 수신처(이메일/문자) 선택 → "보내기".  
- 상세: [3.10 진료 요약 생성·발송](#310-진료-요약-생성발송).

---

### 3.6 [Problem Unit 관리]

**페이지 ID**: `P-PROBLEM-MANAGE`  
**역할**: 문제별 카드 타임라인, 변화 추적, 가설 상태.  
**기능 ID**: F034, F035

#### 3.6.1 진입 경로

- 진료 차팅 내 "Problem 관리" 탭, 또는 환자 상세 > "문제 이력".

#### 3.6.2 레이아웃

- G-NAV-BAR "문제 관리" + 뒤로.
- **Problem 리스트**: 각 G-CARD = 문제명(또는 부위·통증 요약) + 첫 발생일 + 상태(진행중/해결/가설) G-BADGE. 터치 → 하단 또는 다음 화면에서 **타임라인** 노출.
- **타임라인**: 세로 타임라인 UI, 각 Encounter별 "날짜 | S-T-D 요약 | 변화 요약" 노드.
- "새 문제 추가" G-BTN-SECONDARY.

#### 3.6.3 상태

- empty: G-EMPTY "등록된 문제가 없어요" + "새 문제 추가".  
- loading: 스켈레톤 카드.

#### 3.6.4 엣지 케이스

- **병합/분리**: 정책 P-REQ-002 확정 전까지 "문제 합치기" "문제 나누기"는 비활성 또는 Admin만 가능으로 명시.

---

### 3.7 [재진 변화 비교]

**페이지 ID**: `P-REVISIT-DIFF`  
**역할**: 이전 내원 대비 변화 하이라이트, 치료 효과 평가.  
**기능 ID**: F035, F026

#### 3.7.1 진입 경로

- 재진 환자 진료 시작 시 자동 노출(대시보드에서 재진 카드 선택 후 차팅 진입 시 상단 블록).
- 또는 진료 차팅 내 "이전과 비교" 버튼.

#### 3.7.2 레이아웃

- **요약 카드**: "지난 진료 (YYYY.MM.DD)" vs "오늘".  
  - S: 부위·통증도 비교 (화살표 ↑↓ 또는 "같아요").  
  - T: 치료 변경 여부 "유지" / "변경".  
  - D: 재진 일정 준수 여부.  
- **변화 하이라이트**: 변경된 필드만 강조(색상 또는 굵게).  
- **그래프(선택)**: 통증도 시계열 막대/라인 (간단한 차트).

#### 3.7.3 복사

- "지난 진료와 비교", "나아졌어요", "비슷해요", "더 아파요", "변경 없음".

#### 3.7.4 엣지 케이스

- **첫 내원**: 이 블록 비표시.  
- **동일 문제 2회 이상**: "가장 최근 1회" vs 오늘만 기본, "더 많은 이력" 링크 시 리스트 선택.

---

### 3.8 [신체검사]

**페이지 ID**: `P-PHYSICAL-EXAM`  
**역할**: ROM·근력·특수검사·압통점 구조화 입력.  
**기능 ID**: F019, F020, F021, F022, F023

#### 3.8.1 진입 경로

- 진료 차트 > "검사" 탭 또는 "신체검사" 메뉴.

#### 3.8.2 레이아웃

- G-NAV-BAR "신체검사" + 뒤로.
- **검사 그룹 카드**:  
  - **ROM**: 부위 선택 → 좌/우 → 각 방향별 각도 G-INPUT 또는 슬라이더. 정상 범위 밖이면 G-BADGE warning.  
  - **근력**: 부위/등급 0–5 G-CHIP.  
  - **특수검사**: 검사명 리스트 선택 → 결과 G-CHIP "양성" "음성" "미시행".  
  - **압통점**: 해부학 도식 + 터치로 점 찍기, 리스트로 "부위명 | 유무" 추가.  
- 템플릿: "자주 쓰는 검사 세트" G-BTN-GHOST → G-BOTTOM-SHEET에서 선택 시 항목 일괄 추가.
- 하단 G-FLOATING-CTA "검사 저장".

#### 3.8.3 상태

- 정상 범위: 기본 텍스트. 비정상: 해당 셀 배경 연한 빨강 또는 G-BADGE "비정상".
- F030 이상소견 하이라이트: 상단 "주의 소견 n건" 카드 클릭 시 해당 항목으로 스크롤.

#### 3.8.4 엣지 케이스

- **연령/성별 정상치**: P-REQ-008에 따라 서버에서 범위 내려줌, UI는 범위 밖일 때만 강조.

---

### 3.9 [환자 설명 모드]

**페이지 ID**: `P-PATIENT-EXPLAIN`  
**역할**: 차팅 내용을 환자용 언어·시각으로 변환해 함께 보기.  
**기능 ID**: F032

#### 3.9.1 진입 경로

- 진료 차팅 상단 "환자에게 보여주기" 터치 → 전환.

#### 3.9.2 레이아웃

- 전체 화면 또는 큰 모달. 배경 흰색, 글자 18px+.
- **블록별**:  
  - "오늘 불편한 곳" → 부위 일상어 + 좌우 + "통증 정도 OO".  
  - "진단(추정)" → 의학용어 대신 설명 문장.  
  - "치료 계획" → 짧은 문장 + 다음 내원 일자.  
- 해부학 이미지(선택): 부위 하이라이트.
- CTA: "이해했어요" → 모드 종료.

#### 3.9.3 복사·정책

- **변환 규칙·수정 가능 여부·금지 표현**: [2.3 환자 대면 모드 최소 정책](#환자-대면-모드-최소-정책-변환수정금지-표현) 및 PRD **P-REQ-005**(의학 용어 변환 수준) 확정 후 문구 가이드 반영. 기본: 문장 짧고 수동형 지양.

---

### 3.10 [진료 요약 생성·발송]

**페이지 ID**: `P-ENCOUNTER-SUMMARY`  
**역할**: 진료 내용 요약 PDF 생성, 이메일/문자 전송.  
**기능 ID**: F033

#### 3.10.1 진입 경로

- 진료 종료 시 "진료 요약 보내기" 또는 차팅 메뉴 "요약 생성".

#### 3.10.2 레이아웃

- **1단계**: 요약 미리보기 (제목, 진단·치료·다음 내원·주의사항).  
- **2단계**: 수신처 선택 – "이메일" G-INPUT 또는 "문자" G-INPUT (환자 연락처 자동 채움 가능).  
- G-BTN-PRIMARY "보내기".  
- 성공: "요약을 보냈어요" 토스트 + [확인].

#### 3.10.3 엣지 케이스

- **연락처 없음**: "환자 연락처를 먼저 등록해주세요" + 입력 필드.
- **전송 실패**: G-ERROR-BLOCK + [다시 시도] + "PDF 저장" 보조 버튼(로컬 다운로드).

---

### 3.11 [유사 사례 조회]

**페이지 ID**: `P-SIMILAR-CASES`  
**역할**: S-T-D 패턴 매칭으로 과거 케이스 참고.  
**기능 ID**: F011

#### 3.11.1 진입 경로

- 진료 차트 "유사 사례" 버튼.

#### 3.11.2 레이아웃

- G-BOTTOM-SHEET 또는 전용 화면.  
  - 상단: "현재 환자와 비슷한 과거 진료 n건" (유사도 % 또는 점수).  
  - 리스트: G-CARD [익명화된 요약: 부위·진단·결과 한 줄] + "치료 성공" 등 뱃지. 터치 → 상세(마스킹 유지, P-REQ-004).

#### 3.11.3 상태

- empty: "유사한 과거 사례가 없어요".  
- loading: 스켈레톤 3~5개.

---

### 3.12 [Admin – 병원 관리]

**페이지 ID**: `P-ADMIN-TENANT`  
**역할**: 병원 정보, 운영 시간, 로고 등 설정.  
**기능 ID**: F036

#### 3.12.1 레이아웃

- G-NAV-BAR "병원 설정" + 뒤로.
- G-CARD들: 병원명, 병원 코드, 주소, 전화, 로고 업로드, 진료 과목 선택, 운영 요일·시간 (요일별 토글 + 시간 피커).
- G-FLOATING-CTA "저장".

---

### 3.13 [Admin – 사용자 관리]

**페이지 ID**: `P-ADMIN-USERS`  
**역할**: 의료진 계정 CRUD, 권한.  
**기능 ID**: F014

#### 3.13.1 레이아웃

- 목록: G-CARD [이름 | 역할 | 상태 활성/비활성] + chevron.  
- "추가" G-BTN-PRIMARY → 폼(아이디, 이름, 역할 드롭다운, 비밀번호 설정).  
- 편집: 동일 폼 + "비활성화" G-BTN-GHOST (확인 다이얼로그).

---

### 3.14 [Admin – 템플릿 관리]

**페이지 ID**: `P-ADMIN-TEMPLATES`  
**역할**: 증상-부위·검사 세트·치료 프로토콜 템플릿.  
**기능 ID**: F015

#### 3.14.1 레이아웃

- 탭 또는 섹션: "증상-부위", "검사 세트", "치료 프로토콜".  
- 각 항목 G-CARD 리스트 + "추가" → 폼(이름, 항목 목록 편집, 순서 드래그).  
- 저장 시 해당 템플릿이 진료 차팅/신체검사에서 선택 가능.

---

### 3.15 [Admin – 진료 통계]

**페이지 ID**: `P-ADMIN-STATS`  
**역할**: 기간/의사/상병별 집계, 차트.  
**기능 ID**: F016

#### 3.15.1 레이아웃

- 기간 선택 G-CHIP (오늘/7일/30일/직접).  
- 카드: "진료 수", "재진율", "상병 Top 5" 등.  
- 차트: 막대/라인 (질환별, 의사별).  
- "내보내기" G-BTN-GHOST → Excel/CSV.

---

### 3.16 [Admin – 데이터 품질]

**페이지 ID**: `P-ADMIN-QUALITY`  
**역할**: 미완성 차트, ICD 미매핑 탐지.  
**기능 ID**: F018

#### 3.16.1 레이아웃

- 지표 카드: "미완성 n건", "ICD 미매핑 n건".  
- 리스트: 해당 Encounter 링크 → 차팅으로 이동해 보완.

---

### 3.17 [Admin – 요금제]

**페이지 ID**: `P-ADMIN-BILLING`  
**역할**: 현재 플랜, 사용량, 결제.  
**기능 ID**: F037, F038

#### 3.17.1 레이아웃

- 현재 요금제 G-CARD, "변경" → 플랜 비교 테이블.  
- 사용량: 메트릭 (저장 용량, API 호출 등) 막대 또는 숫자.  
- 결제 이력 리스트 + "청구서 받기".

---

## 4. 공통 엣지 케이스·에러 정책

- **401**: 로그인 페이지로 리다이렉트, "다시 로그인해주세요" 토스트.
- **403**: "권한이 없어요" G-ERROR-BLOCK.
- **404**: "찾을 수 없어요" G-EMPTY + 뒤로 또는 대시보드로.
- **5xx/타임아웃**: G-ERROR-BLOCK + [다시 시도].  
- **오프라인**: 상단 배너 + 로컬 저장 가능 기능 안내(해당 시 F012 오프라인 저장 정책 따름).

---

## 5. AI·개발자용 체크리스트 (페이지 구현 시)

- [ ] 해당 페이지 ID·기능 ID(Fxxx) 매핑 확인  
- [ ] G-* 글로벌 컴포넌트 사용 여부  
- [ ] default / loading / empty / error 4종 상태 처리  
- [ ] 복사 문구 문서와 일치  
- [ ] 환자 대면 모드 필요 시 18px+·일상어 변환  
- [ ] tenant_id 노출 없음, 멀티테넌트 격리 유지  
- [ ] 하단 CTA·바텀시트 사용 시 접근성(포커스·스크린리더)  
- [ ] **Situation 입력 관련 (P-ENCOUNTER-CHART)**:  
  - [ ] 해부학 부위 선택: G-ANATOMY-PICKER (탭·도식·검색·다중 선택) 구현  
  - [ ] 통증 유형 선택: G-SEARCHABLE-LIST + G-CHIP-GRID (30개 항목, 검색·자주 쓰는 항목 상단 고정)  
  - [ ] 악화/완화 요인 선택: G-SEARCHABLE-LIST + G-CHIP-GRID (30개 항목, 검색·카테고리 탭 옵션)  
  - [ ] 프로그레시브 디스클로저: 기본은 부위+통증도만, "더 입력하기" 확장 시 나머지 필드 노출  
  - [ ] 템플릿 기능: "자주 쓰는 조합 저장" 및 "템플릿 불러오기" 구현  
  - [ ] 다중 선택 제한: 정책에 따라 최대 선택 개수 제한 시 UI 피드백  
  - [ ] 검색 디바운스: 300ms 디바운스로 API 호출 최소화  
  - [ ] 바텀시트 높이: 해부학 부위 90%, 통증/악화 요인 70% (내용량에 따라 조정)

---

## 6. 페이지–라우트·기능 ID 매핑 (Quick Reference)

| 페이지 ID | 권장 라우트(예) | 주요 기능 ID |
|-----------|------------------|---------------|
| P-LOGIN | `/login` | F001 |
| P-DASHBOARD | `/dashboard` | F002, F016, F018 |
| P-PATIENT-LIST | `/patients` | F002 |
| P-PATIENT-REGISTER | `/patients/new` | F003 |
| P-ENCOUNTER-CHART | `/encounter/:id` 또는 `/chart/:encounterId` | F004, F031, F034, F005–F007, F008, F012, F032 |
| P-PROBLEM-MANAGE | `/patients/:patientId/problems` 또는 차트 내 탭 | F034, F035 |
| P-REVISIT-DIFF | 차트 내 블록 또는 `/encounter/:id/revisit-diff` | F035, F026 |
| P-PHYSICAL-EXAM | `/encounter/:id/exam` 또는 차트 내 탭 | F019–F023 |
| P-PATIENT-EXPLAIN | 차트 내 모드 전환 또는 `/encounter/:id/explain` | F032 |
| P-ENCOUNTER-SUMMARY | `/encounter/:id/summary` | F033 |
| P-SIMILAR-CASES | 바텀시트 또는 `/encounter/:id/similar` | F011 |
| P-ADMIN-TENANT | `/admin/tenant` | F036 |
| P-ADMIN-USERS | `/admin/users` | F014 |
| P-ADMIN-TEMPLATES | `/admin/templates` | F015 |
| P-ADMIN-STATS | `/admin/stats` | F016 |
| P-ADMIN-QUALITY | `/admin/quality` | F018 |
| P-ADMIN-BILLING | `/admin/billing` | F037, F038 |

---

*이 문서는 problem-definition-v2와 prd-mvp-v1을 기반으로, 토스 스타일의 일관된 UI/UX와 상태·엣지 케이스를 정의합니다. 정책 미확정 항목(P-REQ)은 확정 후 본 명세에 반영합니다.*
